---
/**
 * @fileoverview Layout Shell
 * @description The immutable outer shell for all pages. 
 * Fetches Global Settings (nav, footer) from Storyblok and injects them.
 */
import "../styles/global.css";
import Header from "../components/ui/Header.astro";
import Footer from "../components/ui/Footer.astro";
import SEOHead from "../components/system/SEOHead.astro";
import StoryblokBridge from '../components/logic/StoryblokBridge.astro'; 
import { ClientRouter } from 'astro:transitions';
import { getGlobalSettings } from "../lib/storyblok";
import type { GlobalSettings } from "@/types/storyblok";

interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;

// Fetch global settings once per page load
// In a real Storyblok setup, 'config/global-settings' would be a content entry
const globalSettings = await getGlobalSettings() as GlobalSettings | null;
---

<!doctype html>
<html lang="en" class="h-full w-full scroll-smooth">
  <head>
    <SEOHead title={title} description={description} />
    <ClientRouter />
  </head>
  <body class="min-h-screen flex flex-col bg-background font-sans text-foreground antialiased">
    <a 
      href="#main-content" 
      id="skip-nav"
      class="sr-only focus:not-sr-only focus:absolute focus:z-100 focus:top-4 focus:left-4 btn-primary"
    >
      Skip to content
    </a>

    <!-- Pass settings to Header -->
    <Header settings={globalSettings} />

    <main id="main-content" class="flex-1 w-full" data-testid="layout-main">
      <slot />
    </main>

    <!-- Pass settings to Footer -->
    <Footer settings={globalSettings} />
    
    <StoryblokBridge />
  </body>
</html>
